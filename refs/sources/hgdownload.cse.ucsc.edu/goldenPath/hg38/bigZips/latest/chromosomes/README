



shred.sh in=B.fa out=shredded.fa length=80 minlength=70 overlap=40
bbmap.sh ref=A.fa in=shredded.fa outm=mapped.sam minid=0.85 maxindel=2
bbmask.sh in=A.fa out=masked.fa entropy=0.7 sam=mapped.sam





shred.sh in=B.fa out=Bshredded.fa length=80 minlength=70 overlap=40
bbmap.sh ref=A.fa in=Bshredded.fa outm=Bmapped.sam minid=0.85 maxindel=2
bbmask.sh in=A.fa out=Amasked.fa entropy=0.7 sam=Bmapped.sam





#~/.local/BBMap/shred.sh in=chr21.fa out=shredded/chr21.fa length=50 minlength=30 overlap=25
#~/.local/BBMap/bbmap.sh ref=/francislab/data1/refs/bowtie2/SVAs_and_HERVs_KWHE/SVAs_and_HERVs_KWHE/HERVK113.fa in=shredded/chr21.fa outm=shredded/chr21.sam minid=0.85 maxindel=2
#~/.local/BBMap/bbmask.sh in=chr21.fa out=shredded/chr21masked.fa entropy=0.7 sam=shredded/chr21.sam fastawrap=50
#~/.local/BBMap/bbmask.sh in=/francislab/data1/refs/bowtie2/SVAs_and_HERVs_KWHE/SVAs_and_HERVs_KWHE/HERVK113.fa out=shredded/chr21maskedx.fa entropy=0.7 sam=shredded/chr21.sam fastawrap=50


Something is off. Doesn't map as much as I'd expect and there are gaps.


~/.local/BBMap/shred.sh in=/francislab/data1/refs/bowtie2/SVAs_and_HERVs_KWHE/SVAs_and_HERVs_KWHE/HERVK113.fa out=shredded/HERVK113.fa length=50 minlength=30 overlap=25

~/.local/BBMap/bbmap.sh ref=chr21.fa in=shredded/HERVK113.fa outm=shredded/HERVK113.chr21.sam minid=0.85 maxindel=2 ambiguous=all

~/.local/BBMap/bbmask.sh in=chr21.fa out=shredded/masked/chr21.fa entropy=0.7 sam=shredded/HERVK113.chr21.sam fastawrap=50

~/.local/BBMap/bbmap.sh ref=chr6.fa in=shredded/HERVK113.fa outm=shredded/HERVK113.chr6.sam minid=0.85 maxindel=2 ambiguous=all

~/.local/BBMap/bbmask.sh in=chr6.fa out=shredded/masked/chr6.fa entropy=0.7 sam=shredded/HERVK113.chr6.sam fastawrap=50



```
mkdir tmp
mkdir split
for fa in *fa ; do
  echo $fa
  #faSplit -oneFile -extra=25 size ${fa} 25 tmp/split
  i=split/${fa%.fa}.split.fa
  s=${i%.fa}.sam
  #mv tmp/split.fa ${i}
  #bowtie2 -f -U ${i} --no-unal --threads 8 \
  #  --very-sensitive-local \
  #  -x /francislab/data1/refs/refseq/viral-20210916/viral \
  #  -S ${s} 2> ${s%.sam}.summary.txt

	b=${s%.sam}.bed
  samtools sort -n -O SAM -o - ${s} | awk -v s=25 -v ref=${fa%.fa} '(/^split/){
    sub(/^split/,"",$1);
    a=1+s*$1
    b=a+(length($10)-1)
    print ref"\t"a"\t"b
  }' | awk -v ext=0 'BEGIN{FS=OFS="\t"}{
    if( r == "" ){
      r=$1
      s=(($2>ext)?$2:(ext+1))-ext
      e=$3+ext
    } else {
      if( $2 <= (e+ext+1) ){
        e=$3+ext
      }else{
        print $1,s-1,e
        s=$2-ext
        e=$3+ext
      } 
    }
  }END{ if( r != "" ) print r,s-1,e }' > ${b}
done


cat split/*bed | awk 'BEGIN{FS=OFS="\t"}{print $1,$2,$3,$3-$2}' > bed_files_with_region_lengths.txt 

sed 's/\t/,/g' bed_files_with_region_lengths.txt > bed_files_with_region_lengths.csv

sort -t, -k4nr bed_files_with_region_lengths.csv 


```




