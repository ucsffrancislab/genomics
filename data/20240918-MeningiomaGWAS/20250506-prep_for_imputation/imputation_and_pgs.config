/*
========================================================================================
    Nextflow config file for running minimal tests
========================================================================================
    Defines input files and everything required to run a fast and simple pipeline test.
    Use as follows:
        nextflow run main.nf -profile test,development
----------------------------------------------------------------------------------------
*/

//profile = 'slurm'

params {
	project                 = "test-job-22-1kgp3-pgsfull"
	build                   = "hg19"
	files                   = "$PWD/prep/MENINGIOMA_GWAS_SHARED-updated-chr22.vcf.gz"
	password                = "lukas"
//	mode                    = "pgs"
	mode                    = "imputation"

	//refpanel_yaml           = "/francislab/data1/refs/Imputation/hapmap2/imputation-hapmap2.yaml"
	refpanel_yaml           = "/francislab/data1/refs/Imputation/1kgp3/cloudgene.yaml"
	output                  = "output/men-22-1kgp3-pgsfull"

	//chunksize              = 10000000
	chunksize              =    5000000


	encryption = [
		enabled: false
	]

	pgs = [ 
		enabled: true,
		min_r2: 0,
		fix_strand_flips: false,
		category: "all"
	]

	pgscatalog = [
		scores: "/francislab/data1/refs/Imputation/PGSCatalog/hg19.collection.txt.gz",
		meta: "/francislab/data1/refs/Imputation/PGSCatalog/pgs-catalog-20230119-hg19/scores.meta.json"
	]
//		scores: "${projectDir}/tests/data/input/pgs/test-scores.chr20.txt.gz",
//		meta: "${projectDir}/tests/data/input/pgs/test-scores.chr20.json"

//	Needs scores .txt.gz, .txt.gz.info and .txt.gz.tbi
//	I can download and create the scores file


//	I can't find the meta data in json format




// -F "r2Filter=0.3" -F "pgscatalog=apps@pgs-catalog-20240318@1.0" -F "pgs_category=all" 
// -F "job-name=20250624-Meningioma20-imputed-ancestry-1kgdeep" 
// -F "r2Filter=0.3" 
// -F "pgscatalog=apps@pgs-catalog-20240318@1.0" 
// -F "pgs_category=all"  		traits

}


profiles {
	docker.enabled                    = false
	singularity.enabled               = true
	singularity.autoMounts            = true
	process.container                 = 'quay.io/genepi/imputationserver2:v2.0.7'

	singularity.cacheDir = "$HOME"

}


process {
	executor = 'slurm' // --profile slurm
	queue = 'francislab'	// ? 'QueueName'  // replace with your Queue name
	time = '1d' // Set a time limit of 5 days for this process.
	queueSize = 20 // not sure that this makes much difference
}

errorStrategy = {task.exitStatus == 143 ? 'retry' : 'terminate'}
maxErrors = '-1'
maxRetries = 3



/*

    allele_frequency_population = "eur"	// purpose?
Please select the population of your uploaded samples. This information is used solely to compare allele frequencies between your data and the reference panel. Note that not every reference panel supports all sub-populations. If “OFF” is selected, no frequency check will be performed.
Population	Supported Reference Panels
AFR	all
AMR	all
EUR	all
Mixed	all
AA	CAAPA
ASN	1000 Genomes Phase 1 (Version 3)
EAS	1000 Genomes Phase 3 (Version 5)
SAS	1000 Genomes Phase 3 (Version 5)




module load openjdk
nextflow run ~/github/genepi/imputationserver2/main.nf -config 1-test.config



*/

