


nohup ./subsample.bash &



for bam in bam/122*bam ; do
echo $bam
samtools idxstats $bam | awk -vreadlen=150 '{len+=$2;nreads+=$3}END{print nreads * readlen / len }' > $bam.coverage
done

nohup ./call.bash &

for some reason seed 13 creates a problematic bam file for 120207.60a.bam that fails when calling for vcf
and 50a. Trying seed 17.
this is odd since the full file does not have a problem

cat 120207.60a.mpileup.out.txt
Note: none of --samples-file, --ploidy or --ploidy-file given, assuming all sites are diploid
  pileup] 1 samples in 1 input files
[mpileup] maximum number of reads per input file set to -d 250
bcftools: sam.c:3948: resolve_cigar2: Assertion `k < c->n_cigar' failed.
Error: could not parse the input VCF
index: the input is probably truncated, use -f to index anyway: /francislab/data1/working/CCLS/20210121-downsampling_test/vcf/120207.60a.vcf.gz

cat vcf/corrupt/120207.50a.mpileup.out.txt 
Note: none of --samples-file, --ploidy or --ploidy-file given, assuming all sites are diploid
[mpileup] 1 samples in 1 input files
[mpileup] maximum number of reads per input file set to -d 250
bcftools: sam.c:3948: resolve_cigar2: Assertion `k < c->n_cigar' failed.
Error: could not parse the input VCF
index: the input is probably truncated, use -f to index anyway: /francislab/data1/working/CCLS/20210121-downsampling_test/vcf/120207.50a.vcf.gz

recreated bam file with same result. Could try different seed


Mismatch of chrM and MT so not included in output


mkdir newvcf
for f in vcf/122*vcf.gz ; do
echo $f
new=$( basename $f .vcf.gz )
old=${new%.*}
echo "Sub ${old} with ${new}"
zcat $f | sed "/^#CHROM/s/${old}/${new}/" | bgzip > newvcf/${new}.vcf.gz
bcftools index newvcf/${new}.vcf.gz
done



They can be merged into 1 giant vcf file or compared with something like ...
bedtools intersect ...
# or
bcftools isec ...


#	put in decreasing order
nohup bcftools merge -o 120207.vcf.gz -Oz newvcf/120207.100.vcf.gz newvcf/120207.80?.vcf.gz newvcf/120207.60?.vcf.gz newvcf/120207.50?.vcf.gz &
nohup bcftools merge -o 122997.vcf.gz -Oz newvcf/122997.100.vcf.gz newvcf/122997.80?.vcf.gz newvcf/122997.60?.vcf.gz newvcf/122997.50?.vcf.gz &
nohup bcftools merge -o 186069.vcf.gz -Oz newvcf/186069.100.vcf.gz newvcf/186069.80?.vcf.gz newvcf/186069.60?.vcf.gz newvcf/186069.50?.vcf.gz &



BOX="https://dav.box.com/dav/Francis _Lab_Share/20210127 CCLS 20210121-downsampling_test"
curl -netrc -X MKCOL "${BOX}/"

curl -netrc -T 122997.vcf.gz "${BOX}/"
curl -netrc -T 122997.vcf.gz.csi "${BOX}/"

